<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Weekly Picks Results</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 40px;
      background-color: #f5f5f5;
    }
    h1 {
      text-align: center;
    }
    h2 {
      margin-top: 40px;
    }
    table {
      border-collapse: collapse;
      width: 100%;
      max-width: 600px;
      margin-bottom: 30px;
      background-color: #fff;
      box-shadow: 0 0 5px rgba(0,0,0,0.1);
    }
    th, td {
      border: 1px solid #ccc;
      padding: 8px 12px;
      text-align: left;
    }
    th {
      background-color: #007bff;
      color: white;
    }
    .correct {
      background-color: #d4edda; /* green */
    }
    .incorrect {
      background-color: #f8d7da; /* red */
    }
  </style>
</head>
<body>
  <h1>Weekly Picks Results</h1>
  <div id="results"></div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.28.0/firebase-app.js";
    import { getFirestore, collection, getDocs } from "https://www.gstatic.com/firebasejs/11.28.0/firebase-firestore.js";

    // TODO: Replace with your Firebase config
  const firebaseConfig = {
  apiKey: "AIzaSyAkSlyFKQNHYQgLa_dQuzjYSzXSISoCWKU",
  authDomain: "college-football-pickem-68eed.firebaseapp.com",
  projectId: "college-football-pickem-68eed",
  storageBucket: "college-football-pickem-68eed.appspot.com",
  messagingSenderId: "650202039805",
  appId: "1:650202039805:web:70e51177aab22e4d614594"
};

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    const collectionName = "week4Picks";
    const gameSlate = [
      "401752708", "401752709", "401752714", "401752843", "401752844", "401752846",
      "401754538", "401754636", "401754640", "401756896", "401756898", "401756901",
      "401757259", "401757261", "401757262", "401757263", "401757264", "401757267",
      "401760373", "401760374", "401760376", "401761610", "401761613", "401762468",
      "401762469"
    ];

    async function getGameResult(eventId) {
      const url = `https://site.api.espn.com/apis/site/v2/sports/football/college-football/summary?event=${eventId}`;
      const res = await fetch(url);
      if (!res.ok) return null;
      const data = await res.json();
      const competitors = data?.header?.competitions?.[0]?.competitors ?? [];
      const winner = competitors.find(c => c.winner === true);
      const matchupName = competitors.map(c => c.team.displayName).join(" vs ");
      return {
        winnerId: winner?.team?.id ?? null,
        competitors,
        matchupName
      };
    }

    async function renderResults() {
      const resultsContainer = document.getElementById('results');
      const snapshot = await getDocs(collection(db, collectionName));
      if (snapshot.empty) {
        resultsContainer.textContent = "No picks found.";
        return;
      }

      for (const doc of snapshot.docs) {
        const data = doc.data();
        const userName = data.name;
        const picks = data.picks;

        let wins = 0;
        let losses = 0;
        const correctPicks = [];
        const incorrectPicks = [];

        for (const eventId of gameSlate) {
          const result = await getGameResult(eventId);
          if (!result || !result.winnerId) continue;

          const { winnerId, competitors, matchupName } = result;
          const userPick = picks[eventId];
          const winnerTeam = competitors.find(c => c.team.id === winnerId).team.displayName;
          const pickTeam = competitors.find(c => c.team.id === userPick)?.team.displayName;

          if (userPick === winnerId) {
            wins++;
            correctPicks.push(winnerTeam);
          } else {
            losses++;
            if (userPick) {
              incorrectPicks.push(pickTeam);
            } else {
              incorrectPicks.push(`NoPick : ${matchupName}`);
            }
          }
        }

        // Create user table
        const div = document.createElement('div');
        div.classList.add('user-report');
        const h2 = document.createElement('h2');
        h2.textContent = `${userName} W-L (${wins}-${losses})`;
        div.appendChild(h2);

        const table = document.createElement('table');
        const thead = document.createElement('thead');
        const headerRow = document.createElement('tr');
        ["Correct Picks", "Incorrect Picks"].forEach(text => {
          const th = document.createElement('th');
          th.textContent = text;
          headerRow.appendChild(th);
        });
        thead.appendChild(headerRow);
        table.appendChild(thead);

        const tbody = document.createElement('tbody');
        const maxRows = Math.max(correctPicks.length, incorrectPicks.length);
        for (let i = 0; i < maxRows; i++) {
          const tr = document.createElement('tr');

          const tdCorrect = document.createElement('td');
          tdCorrect.textContent = correctPicks[i] ?? "";
          if (correctPicks[i]) tdCorrect.classList.add('correct');

          const tdIncorrect = document.createElement('td');
          tdIncorrect.textContent = incorrectPicks[i] ?? "";
          if (incorrectPicks[i]) tdIncorrect.classList.add('incorrect');

          tr.appendChild(tdCorrect);
          tr.appendChild(tdIncorrect);
          tbody.appendChild(tr);
        }

        table.appendChild(tbody);
        div.appendChild(table);
        resultsContainer.appendChild(div);
      }
    }

    renderResults().catch(err => console.error("Error rendering picks:", err));
  </script>
</body>
</html>


