<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>View Picks</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
</head>
<body class="bg-dark text-white">
  <div class="container mt-5">
    <h2 class="mb-4">Week 0 Picks</h2>
    <div id="picksTableContainer"></div>
  </div>

  <script>
    // Firebase config (same as your main script)
    const firebaseConfig = {
      apiKey: "AIzaSyAkSlyFKQNHYQgLa_dQuzjYSzXSISoCWKU",
      authDomain: "college-football-pickem-68eed.firebaseapp.com",
      projectId: "college-football-pickem-68eed",
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    async function renderPicksTable() {
      const snapshot = await db.collection("weekPicks").where("week", "==", 0).get();
      const allDocs = snapshot.docs.map(doc => doc.data());

      // Step 1: Extract unique matchups
      const allMatchups = new Set();
      allDocs.forEach(doc => {
        Object.keys(doc.picks).forEach(matchup => allMatchups.add(matchup));
      });
      const matchups = Array.from(allMatchups).sort();

      // Step 2: Extract unique users
      const users = allDocs.map(doc => doc.name);

      // Step 3: Build HTML table
      const table = document.createElement('table');
      table.className = "table table-bordered table-striped table-dark";

      // Header row
      const thead = document.createElement('thead');
      const headerRow = document.createElement('tr');

      const gameHeader = document.createElement('th');
      gameHeader.textContent = 'Matchup';
      headerRow.appendChild(gameHeader);

      users.forEach(user => {
        const th = document.createElement('th');
        th.textContent = user;
        headerRow.appendChild(th);
      });

      thead.appendChild(headerRow);
      table.appendChild(thead);

      // Body
      const tbody = document.createElement('tbody');

      matchups.forEach(matchup => {
        const row = document.createElement('tr');

        const matchupCell = document.createElement('td');
        matchupCell.textContent = matchup.replace(/_/g, ' vs ').replace(/vs vs/g, 'vs');
        row.appendChild(matchupCell);

        users.forEach(user => {
          const doc = allDocs.find(d => d.name === user);
          const pick = doc?.picks?.[matchup] || '';
          const td = document.createElement('td');
          td.textContent = pick;
          row.appendChild(td);
        });

        tbody.appendChild(row);
      });

      table.appendChild(tbody);

      // Add to page
      document.getElementById('picksTableContainer').appendChild(table);
    }

    renderPicksTable().catch(console.error);
  </script>
</body>
</html>
